<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />

        <!-- RPD: css -->
        <link rel="stylesheet" href="./rpd.css"></link>
        <!-- Toolkit: jb (svg) -->
        <link rel="stylesheet" href="./toolkit/jb/svg.css"></link>

        <!-- Kefir.js library -->
        <script src="./kefir.min.js"></script>

        <!-- RPD Library (http://shamansir.github.io/rpd) -->
        <script src="./rpd.min.js"></script>

        <!-- Toolkit: jb, utils -->
        <script src="./toolkit/jb/shared.js"></script>
        <!-- Toolkit: jb -->
        <script src="./toolkit/jb/toolkit.js"></script>
        <!-- Toolkit: jb (svg) -->
        <script src="./toolkit/jb/svg.js"></script>

        <!-- p5.js -->
        <script src="./p5.min.js"></script>
        <script src="./p5.dom.js"></script>

        <style>
            .p5-canvas {
                position: fixed;
            }

            .rpd-node.rpd-util-knob .rpd-process text {
                fill: red !important;
            }
        </style>

    </head>
    <body>

        <script>
            // Build and render patch

            var patch = Rpd.addPatch('jb-sketch');

            patch.render('svg', document.body, { style: 'compact-v',
                                                 fullPage: true });
            var render1 = patch.addNode('jb/render').move(200, 200);
            var render2 = patch.addNode('jb/render').move(450, 260);

            var layers = patch.addNode('jb/layers').move(500, 130);

            var ellipse = patch.addNode('jb/ellipse').move(50, 50);
            ellipse.outlets['forms'].connect(render1.inlets['forms']);

            var knob1 = patch.addNode('util/knob').move(200, 40);
            var knob2 = patch.addNode('util/knob').move(250, 40);

            var modify = patch.addNode('jb/modify').move(30, 150);
            knob1.outlets['number'].connect(modify.inlets['x']);
            knob2.outlets['number'].connect(modify.inlets['y']);
            knob1.inlets['submit'].receive(0.2);

            ellipse.outlets['forms'].connect(modify.inlets['forms']);
            ellipse.outlets['forms'].connect(layers.inlets['L0']);
            modify.outlets['forms'].connect(layers.inlets['L1']);
            layers.outlets['forms'].connect(render2.inlets['forms']);

            var bang = patch.addNode('util/bang').move(10,10);
            bang.outlets['bang'].connect(ellipse.inlets['bang']);
            setTimeout(function() {
                bang.inlets['trigger'].receive({})
            }, 100);

            patch.addNode('util/nodelist').move(800, 50);

        </script>

    </body>
</html>
